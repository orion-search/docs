<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<title data-react-helmet="true">Running Orion&#x27;s ETL | Orion</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Running Orion&#x27;s ETL | Orion"><meta data-react-helmet="true" name="description" content="This tutorial walks you through Orion&#x27;s ETL. It shows you how to modify Orion&#x27;s DAG, collect, enrich and analyse data from Microsoft Academic Graph."><meta data-react-helmet="true" property="og:description" content="This tutorial walks you through Orion&#x27;s ETL. It shows you how to modify Orion&#x27;s DAG, collect, enrich and analyse data from Microsoft Academic Graph."><meta data-react-helmet="true" property="og:url" content="https://orion-search.github.io/docs/docs/running_etl"><link data-react-helmet="true" rel="shortcut icon" href="/docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://orion-search.github.io/docs/docs/running_etl"><link rel="stylesheet" href="/docs/styles.e6e8e8cd.css">
<link rel="preload" href="/docs/styles.1667a3ac.js" as="script">
<link rel="preload" href="/docs/runtime~main.81c217c2.js" as="script">
<link rel="preload" href="/docs/main.699aadc8.js" as="script">
<link rel="preload" href="/docs/1.2525661c.js" as="script">
<link rel="preload" href="/docs/2.71e354db.js" as="script">
<link rel="preload" href="/docs/36.962bbfeb.js" as="script">
<link rel="preload" href="/docs/37.6b2984da.js" as="script">
<link rel="preload" href="/docs/64f9f2ab.21b20305.js" as="script">
<link rel="preload" href="/docs/17896441.d74c7bc7.js" as="script">
<link rel="preload" href="/docs/d1ce5678.55fc9fa1.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/docs/"><img class="navbar__logo" src="/docs/img/logo.png" alt="Orion Search logo"><strong class="navbar__title">Orion</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/docs/">Docs</a><a class="navbar__item navbar__link" href="/docs/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/orion-search" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/docs/"><img class="navbar__logo" src="/docs/img/logo.png" alt="Orion Search logo"><strong class="navbar__title">Orion</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/orion-search" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp" role="complementary"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Overview</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/Data Sources">Data Sources</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/Research Indicators">Research Indicators</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/External Dependencies">External Dependencies</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/Contributing">Contributing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/Use Cases">Use Cases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/doc1">Style Guide</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Components</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">ETL</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/Data Pipeline">Data Pipeline</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/The model config file">The model config file</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docs/Operators">Operators</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Tutorials</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/docs/running_etl">Running Orion&#x27;s ETL</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Running Orion&#x27;s ETL</h1></header><div class="markdown"><p>This tutorial walks you through Orion&#x27;s ETL. It shows you how to modify Orion&#x27;s DAG, collect, enrich and analyse data from Microsoft Academic Graph.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="get-orion"></a>Get Orion<a aria-hidden="true" tabindex="-1" class="hash-link" href="#get-orion" title="Direct link to heading">#</a></h2><p>Clone the repository:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> clone https://github.com/orion-search/orion</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="modify-model_configyaml"></a>Modify <code>model_config.yaml</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#modify-model_configyaml" title="Direct link to heading">#</a></h2><p><code>model_config.yaml</code> contains Orion&#x27;s configuration parameters. Change the following: </p><ol><li><strong>Database name</strong></li></ol><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">db_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;arxiv_cl&#x27;</span></div></div></div></div></div><p>This is where Orion stores the MAG data.</p><p><strong>2. MAG query parameters</strong></p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">mag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">query_values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;arxiv computation and language&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">entity_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;J.JN&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Id&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Ti&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;AA.AfId&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;AA.AfN&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;AA.AuId&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;AA.DAuN&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;AA.S&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;CC&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;D&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;F.DFN&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;F.FId&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;J.JId&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;J.JN&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Pt&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;RId&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Y&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;DOI&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;PB&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;BT&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;IA&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;C.CN&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;C.CId&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;DN&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;S&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">with_doi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">False</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">mag_start_date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2020-05-01&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">mag_end_date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2020-05-30&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">intervals_in_a_year</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span></div></div></div></div></div><p>We will query MAG with <code>arxiv computation and language</code> and specify that is a journal using the <code>J.JN</code> in the <code>entity_name</code> field. <code>metadata</code> contains all the <a href="https://docs.microsoft.com/en-us/academic-services/project-academic-knowledge/reference-paper-entity-attributes" target="_blank" rel="noopener noreferrer">MAG fields</a> that Orion collects. We set the <code>mag_start_date</code> and <code>mag_end_date</code> to 2020-05-01 and 2020-05-30 respectively to collect papers published in May 2020. We will collect documents even if they do not have a DOI. We can specify this by setting the <code>with_doi</code> parameter to <code>False</code>.</p><p><strong>3. S3 buckets</strong></p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">s3_buckets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">mag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;cl-mag-data-dump&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">gender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;cl-names-batches&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">text_vectors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;cl-document-vectors&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">topic</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;cl-mag-topics&quot;</span></div></div></div></div></div><p>Set the S3 buckets that Orion will create and store intermediate data.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="modify-the-environmental-variables-in-env"></a>Modify <strong>the environmental variables in <code>.env</code></strong><a aria-hidden="true" tabindex="-1" class="hash-link" href="#modify-the-environmental-variables-in-env" title="Direct link to heading">#</a></h2><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># postgresdb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">arxiv_cl=postgres+psycopg2://postgres:admin@postgres:5432/arxiv_cl</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">postgres=postgres+psycopg2://postgres:admin@postgres:5432/postgres</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># mag</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mag_api_key=&lt;MAG_API_KEY&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># NOT USED IN THE TUTORIAL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># google_api_key=&lt;GOOGLE_API_KEY&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># NOT USED IN THE TUTORIAL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># gender_api=&lt;GENDERAPI_AUTH&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># NOT USED IN THE TUTORIAL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># es_host=&lt;AWS_ES_ENDPOINT&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># es_port=&lt;AWS_ES_PORT&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># es_index=&lt;AWS_ES_INDEX_NAME&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># region=&lt;AWS_ES_REGION&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># docker-compose.yml ENV variables</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">DB_HOST=postgres</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">DB_PORT=5432</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">DB_USER=postgres</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">DB_PASS=admin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">MAIN_DB=arxiv_cl</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">DB_NAME=airflow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">AWS_ACCESS_KEY_ID=&lt;AWS_ACCESS_KEY_ID&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">AWS_SECRET_ACCESS_KEY=&lt;AWS_SECRET_ACCESS_KEY&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">AWS_DEFAULT_REGION=&lt;AWS_DEFAULT_REGION&gt;</span></div></div></div></div></div><p>Create a <code>.env</code> file in the root directory and add the above. Alternatively, you can modify the <code>.env.example</code> file and rename it to <code>.env</code>. <code>.env</code> contains the environmental variables used in Orion. For this tutorial, we define the PostgreSQL databases, the MAG API key, the AWS credentials and the environmental variables used in Docker.</p><p>To run the tutorial, you need to create an <strong>AWS account</strong> and get an <strong>API key for the Microsoft Academic Graph</strong>. See External Dependencies for details.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="build-the-docker-container"></a>Build the docker container<a aria-hidden="true" tabindex="-1" class="hash-link" href="#build-the-docker-container" title="Direct link to heading">#</a></h2><p>Orion&#x27;s ETL runs in a docker container. The <code>docker-compose.yml</code> has the instructions to create two containers; one for the PostgreSQL database and another one for Orion&#x27;s data pipeline. Use the following command to <strong>build</strong> and <strong>run</strong> the containers:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose up</span></div></div></div></div></div><p>This should take some time to run. After the setup, you will receive a stream of messages about the PostgreSQL database and Airflow like the one below. </p><img alt="docker-compose" src="/docs/img/airflow-log.png"><p>If you need to make changes in a file after running <code>docker-compose up</code>, you should do the following to update the docker container:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose up --build</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="run-the-dag-with-airflows-ui"></a>Run the DAG with Airflow&#x27;s UI<a aria-hidden="true" tabindex="-1" class="hash-link" href="#run-the-dag-with-airflows-ui" title="Direct link to heading">#</a></h2><p>Airflow is running locally and you can access it at:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">http://localhost:8080/admin/</span></div></div></div></div></div><p>Here, you can see all the DAGs in the <code>orion/core/dags</code> directory. Turn on the <code>tutorial</code> DAG and click on it.</p><img alt="Airflow UI" src="/docs/img/airflow-ui-on.png"><p>You can inspect the DAG in different ways, let&#x27;s choose the <strong>Graph View.</strong> You can see all the tasks and their dependencies in the DAG. Let&#x27;s list the tasks in the <code>tutorial</code> DAG:</p><ul><li>Create Orion&#x27;s PostgreSQL database and tables.</li><li>Create AWS S3 buckets.</li><li>Collect four indicators from the World Bank.</li><li>Query Microsoft Academic Graph with the configuration parameters we set in step 2.</li><li>Parse the Microsoft Academic Graph response and store it in the PostgreSQL database.</li><li>Tag open access publications.</li><li>Tag non-industry author affiliations.</li><li>Collect metadata and calculate statistics on the Fields of Study used in the publications we retrieved.</li><li>Assign a set of thematic topics to the academic publications based on their Fields of Study.</li></ul><img alt="Airflow  DAG" src="/docs/img/airflow-dag.png"><p>Click on <strong>Trigger DAG.</strong> It will run all tasks in the pipeline. The status of the DAG will change to <strong>running</strong> and the border of the tasks will turn <strong>green</strong> as they are completed successfully.</p><img alt="Sucessful tasks" src="/docs/img/airflow-successful-tasks.png"><p>The run will be completed once the status of the DAG changes to <strong>success.</strong></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="access-the-database"></a>Access the database<a aria-hidden="true" tabindex="-1" class="hash-link" href="#access-the-database" title="Direct link to heading">#</a></h2><p>There are three ways to access the database.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="using-psql"></a>Using <code>psql</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-psql" title="Direct link to heading">#</a></h3><p>If you have <code>psql</code> installed, type in your terminal:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">psql arxiv_cl -h localhost postgres</span></div></div></div></div></div><p>You will be prompted to type your password which is <code>admin</code> (we set it in the <code>.env</code> file). </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="using-the-docker-container"></a>Using the docker container<a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-the-docker-container" title="Direct link to heading">#</a></h3><p>If you do not have <code>psql</code>, do the following to open the the <code>postgres</code> container in interactive mode:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">exec</span><span class="token plain"> -it postgres psql -U postgres arxiv_cl</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="using-sqlalchemy"></a>Using SQLAlchemy<a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-sqlalchemy" title="Direct link to heading">#</a></h3><p>This is the most useful way if you plan to use the data in your analysis. You can either access the data from the docker container or export the database to your local PostgreSQL distribution. Let&#x27;s do the latter.</p><p>While the docker container is running, type the following in a separate shell to store the <code>arxiv_cl</code> database in a <code>sql</code> file:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">exec</span><span class="token plain"> -t postgres pg_dump --no-owner -U postgres arxiv_cl </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> arxiv_cl_dump.sql</span></div></div></div></div></div><p>Shut down the container, open your local PostgreSQL distribution and type</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">psql -d arxiv_cl </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> arxiv_cl_dump.sql</span></div></div></div></div></div><p>to load the database dump in a local database named <code>arxiv_cl</code>. Note that you have to create the local database before loading the dump. You can then use Python&#x27;s <code>SQLAlchemy</code> to read the data.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-python codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> sqlalchemy </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> create_engine</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> sqlalchemy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">orm </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> sessionmaker</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">db_config </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;postgres+psycopg2://postgres@localhost:5432/arxiv_cl&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">engine </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> create_engine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">db_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Session </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> sessionmaker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">engine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">s </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> Session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/Running the ETL.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/docs/Operators"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Operators</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#get-orion" class="table-of-contents__link">Get Orion</a></li><li><a href="#modify-model_configyaml" class="table-of-contents__link">Modify <code>model_config.yaml</code></a></li><li><a href="#modify-the-environmental-variables-in-env" class="table-of-contents__link">Modify <strong>the environmental variables in <code>.env</code></strong></a></li><li><a href="#build-the-docker-container" class="table-of-contents__link">Build the docker container</a></li><li><a href="#run-the-dag-with-airflows-ui" class="table-of-contents__link">Run the DAG with Airflow&#39;s UI</a></li><li><a href="#access-the-database" class="table-of-contents__link">Access the database</a><ul><li><a href="#using-psql" class="table-of-contents__link">Using <code>psql</code></a></li><li><a href="#using-the-docker-container" class="table-of-contents__link">Using the docker container</a></li><li><a href="#using-sqlalchemy" class="table-of-contents__link">Using SQLAlchemy</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/docs/introduction">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/docs/running_etl">Tutorials</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/kstathou" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/orion-search" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 Orion Search. Built with Docusaurus.</div></div></div></footer></div>
<script src="/docs/styles.1667a3ac.js"></script>
<script src="/docs/runtime~main.81c217c2.js"></script>
<script src="/docs/main.699aadc8.js"></script>
<script src="/docs/1.2525661c.js"></script>
<script src="/docs/2.71e354db.js"></script>
<script src="/docs/36.962bbfeb.js"></script>
<script src="/docs/37.6b2984da.js"></script>
<script src="/docs/64f9f2ab.21b20305.js"></script>
<script src="/docs/17896441.d74c7bc7.js"></script>
<script src="/docs/d1ce5678.55fc9fa1.js"></script>
</body>
</html>